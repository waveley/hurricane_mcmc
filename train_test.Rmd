---
title: "train test"
author: "Haolin Zhong"
date: "2022/5/5"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ModelMetrics)
```

## Data Preparation

```{r}
source("shared_code/data_cleaning.R")
load("generated_data/B_final.RData")
temp = distinct(test, i) %>% add_rownames("new_i")
test = test %>% left_join(temp)
test = test %>% dplyr::select(-wkt_old)
```


```{r}
my.predict = function(B, newdata) {
  res = c()
  
  for (j in 1:nrow(newdata)) {
    i = newdata[j,] %>% pull(new_i) %>% as.numeric()
    x = c(1, as.matrix(test[j, 3:6]))
    pred = sum(B[i,] * x)
    res = c(res, pred)
  }
  return(res)
}
```


```{r}
pred = my.predict(B_final, test)
rmse(pred, test$wkt_new)
```




